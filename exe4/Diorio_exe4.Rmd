---
title: "Exercise_4_Adv_statistics"
author: "Ada D'Iorio"
output: 
html_document: 
number_sections: true 
theme: spacelab 
pdf_document:
    latex_engine: xelatex
date: "2024-05-04"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Exercise 1**

-   A well established and diffused method for detecting a disease in
    blood fails to detect the presence;

of disease in 15% of the patients that actually have the disease. - A
young UniPD startUp has developed an innovative method of screening.
During the qualification phase, a random sample of n = 75 patients known
to have the disease is screened using the new method.

(a) What is the probability distribution of y, the number of times the
    new method fails to detect the disease?
(b) On the $n =75$ patients sample, the new method fails to detect the
    disease in y = 6 cases. What is the frequentist estimator of the
    failure probability of the new method?
(c) Setup a bayesian computation of the posterior probability, assuming
    a beta distribution with mean value 0.15 and standard deviation
    0.14. Plot the posterior distribution for y, and mark on the plot
    the mean value and variance;
(d) Perform a test of hypothesis assuming that if the probability of
    failing to the detect the desease in ill patients is greater or
    equal than 15%, the new test is no better that the traditional
    method. Test the sample at a 5% level of significance in the
    Bayesian way;
(e) Perform the same hypothesis test in the classical frequentist way.

**Exercise 2**

-   A researcher has collected \$ n   =  16 \$ observations that are
    supposed to come from a Normal distribution with known variance
    $\sigma^2 \ = \ 4$:

\$  4.09  4.68  1.87  2.62  5.58  8.68  4.07  4.78 \\ 4.79  4.49  5.85 
5.09  2.40  6.27 6.30  4.47 \$

-   Assuming the prior is a step function:

$$
g(\mu) = \begin{cases}
\mu & \text{for } 0 < \mu \le 3, \\
3 & \text{for } 3 < \mu \le 5, \\
8 - \mu & \text{for } 5 < \mu \le 8, \\
0 & \text{for } \mu > 8
\end{cases}
$$

(a) Find the posterior distribution, the posterior mean and standard
    deviation
(b) Find the 95% credibility interval for $\mu$;
(c) Plot the posterior distribution, indicating on the same plot: the
    mean value, the standard deviation, and the $95 \%$ credibility
    interval;
(d) Plot, on the same graph, the prior, the likelihood and the posterior
    distribution.

**Exercise 3**

The six boxes toy model is described in reference \textbf{[1]}.

-   Labeling the boxes as follows:

    ![](images/Screenshot%202024-05-13%20195727.png)

-   Write a program in R that:

1)  Selects a random box;
2)  Makes a random sampling from the box;
3)  Prints on the standard output the probability of selecting each box;
4)  Plots the probability for each box as a function of the number of
    trials.

```{r}

  
  
sample_from_box <- function(box) {
  prob_white <- c(1/6, 2/6, 3/6, 4/6, 5/6, 6/6)
  rbinom(1, 1, prob_white[box + 1])
}
  



update_probabilities <- function(prior_probabilities, result) {
  prob_white <- c(1/6, 2/6, 3/6, 4/6, 5/6, 6/6)
  
  likelihood <- numeric(6)
  
  for (i in 1:length(prob_white)) {
    likelihood[i] <- ifelse(result == 1, prob_white[i], 1 - prob_white[i])
  }

  #likelihood <- ifelse(result == 1, prob_white, 1 - prob_white)
  
  # restituisce prob_white se il risultato è 1, 1 - prob_white se il risultato è 0
 
  posterior_probabilities <- prior_probabilities * likelihood
  # prodotto di un vettore iniziale (prior_probabilities) per la likelihood che è anche essa un vettore 
  
  posterior_probabilities <- posterior_probabilities / sum(posterior_probabilities)
  
  
  return(posterior_probabilities)
}



random_sampling <- function(num_trials, boxes) {
  probabilities <- rep(1/6, 6)
  plot_data <- matrix(nrow = num_trials+1, ncol = 6)
  
  
  plot_data[1,] <- probabilities
  
  set.seed(123)
  
  for (i in 1:num_trials) {
    
    box_selected <- sample(0:5, 1)
    item <- sample_from_box(box_selected)
    probabilities <- update_probabilities(plot_data[i,], item)
    
    plot_data[i+1, ] <- probabilities
    
  }
  
  for (i in 1:6) {
  plot(1:(num_trials+1), plot_data[,i], lty = 1, col = i,
          xlab = 'Numero di prove', ylab = 'Probabilità',
          main = paste('Probability for H', i))
  grid()
  }
  
  paste('--------------------------------------------------')
  paste('Probabilities for:')
  cat(paste(sprintf('H_0 \ H_1 \ H_2 \ H_3 \ H_4 \ H_5 \ H_6 \n')))
  print(plot_data)
}



# Numero di prove
num_trials <- 60

# Esecuzione del campionamento casuale e plottaggio delle probabilità
random_sampling(num_trials, boxes)



```


